<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة الصلاة | الجمعية الخيرية مسك الختام</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root { --gold: #d4af37; }
body{
  margin:0;
  font-family:"Tahoma",sans-serif;
  background:url("bniharoun.jpg") center/cover no-repeat fixed;
}
.overlay{
  min-height:100vh;
  background:rgba(0,0,0,0.6);
  display:flex;justify-content:center;align-items:center;
}
.panel{
  width:360px;
  max-width:95%;
  border:2px solid var(--gold);
  border-radius:20px;
  padding:16px;
  color:#fff;
  background:rgba(0,0,0,0.55);
  box-shadow:0 0 25px rgba(212,175,55,.4);
  text-align:center;
}
.header h1{
  margin:4px 0;font-size:18px;color:var(--gold);
}
.header .place{
  font-size:14px;opacity:.9;margin-bottom:10px;
}
.clock{
  margin:12px 0;font-size:34px;padding:10px;
  border:2px solid var(--gold);border-radius:14px;
  background:rgba(0,0,0,.4);
}
.date{font-size:13px;margin-bottom:10px;}
.table-prayers{width:100%;border-collapse:collapse;}
.table-prayers th,.table-prayers td{
  border:1px solid var(--gold);padding:6px;font-size:14px;text-align:center;
}
.current{background: rgba(212,175,55,.25); font-weight:bold;}
.countdown{margin-top:10px;font-size:15px;color: var(--gold);}
.footer{margin-top:6px;font-size:11px;opacity:.8;}
</style>
</head>
<body>
<div class="overlay">
  <div class="panel">
    <div class="header">
      <h1>الجمعية الخيرية مسك الختام</h1>
      <div class="place">القرارم قوقة – مسجد سلمان الفارسي</div>
    </div>

    <div class="clock" id="clock">--:--:--</div>
    <div class="date" id="date"></div>

    <table class="table-prayers" id="prayer-table">
      <thead><tr><th>الصلاة</th><th>الوقت</th></tr></thead>
      <tbody></tbody>
    </table>

    <div class="countdown" id="countdown"></div>
    <div class="footer">المواقيت مأخوذة مباشرة من MAWAQIT عبر الخادم الوسيط</div>
  </div>
</div>

<script>
// ===== الساعة =====
function updateClock(){
  document.getElementById("clock").textContent =
    new Date().toLocaleTimeString("ar-DZ",{hour12:false});
}
setInterval(updateClock,1000);
updateClock();

// ===== التاريخ =====
(function(){
  const now=new Date();
  const hijri=now.toLocaleDateString("ar-SA-u-ca-islamic",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
  const miladi=now.toLocaleDateString("ar-DZ",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
  document.getElementById("date").innerHTML = hijri + "<br>" + miladi;
})();

// ===== جدول الصلاة =====
let prayers = [];

async function fetchPrayers(){
  try{
    // رابط الخادم الوسيط الذي سننشئه على Vercel
    const res = await fetch("https://misk-prayer-proxy.vercel.app/prayer-times.json");
    prayers = await res.json();
    renderPrayers();
    startCountdown();
  }catch(e){
    console.error("خطأ في جلب أوقات الصلاة:", e);
  }
}

function renderPrayers(){
  const tbody = document.querySelector("#prayer-table tbody");
  tbody.innerHTML="";
  prayers.forEach(p=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${p.name}</td><td>${p.time}</td>`;
    tbody.appendChild(tr);
  });
}

function startCountdown(){
  setInterval(()=>{
    const now=new Date();
    let next=null;
    document.querySelectorAll("#prayer-table tr").forEach(r=>r.classList.remove("current"));
    prayers.forEach((p,i)=>{
      const [h,m] = p.time.split(":");
      const d = new Date();
      d.setHours(h,m,0,0);
      const row = document.querySelectorAll("#prayer-table tr")[i];
      if(now>=d) row.classList.add("current");
      if(!next && now<d) next={name:p.name,time:d};
    });
    if(next){
      const diff = next.time-now;
      const h = Math.floor(diff/3600000);
      const m = Math.floor((diff%3600000)/60000);
      const s = Math.floor((diff%60000)/1000);
      document.getElementById("countdown").textContent=`المتبقي لصلاة ${next.name}: ${h}:${m}:${s}`;
    }
  },1000);
}

// جلب أوقات الصلاة تلقائيًا من الخادم
fetchPrayers();
</script>
</body>
</html>
